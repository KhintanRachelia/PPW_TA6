<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <title>Weather Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            skysoft: "#e6f3ff",
            skydeep: "#2d3f66",
            lilac: "#e7ddff",
            blush: "#ffdfe9",
            accent: "#f97373",
            slateD: "#0b1020",
            nightBlue: "#07102a",
            sunGlow: "#fff4cc"
          },
          borderRadius: { xlx: "1.4rem" },
          fontFamily: { sans: ["Inter", "system-ui", "sans-serif"] },
          boxShadow: { soft: "0 18px 45px rgba(15,23,42,0.16)" }
        }
      }
    }
  </script>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

    :root{
      --bg-gradient: radial-gradient(circle at top, #fdfbff 0, #dde9ff 35%, #c9d5ff 60%, #b4c5ff 85%, #93b5ff 100%);
      --cloud-opacity: 0.25;
      --glass-border: rgba(255,255,255,0.7);
    }
    .dark:root, .dark{
      --bg-gradient: linear-gradient(180deg,#05081a 0%, #050b1e 45%, #020617 100%);
      --cloud-opacity: 0.12;
      --glass-border: rgba(148,163,184,0.18);
    }

    html,body{height:100%;}
    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      margin:0;
      background: var(--bg-gradient);
      overflow-x:hidden;
      transition:background .45s ease, color .25s ease;
    }

    .cloud-layer {
      position: fixed;
      inset:0;
      width:200%;
      background:url('https://i.ibb.co/3v8Z7G6/softclouds.png') repeat-x;
      background-size:cover;
      opacity:var(--cloud-opacity);
      animation:clouds-move 80s linear infinite;
      pointer-events:none;
      z-index:-2;
      transition:opacity .45s ease;
    }
    @keyframes clouds-move{0%{transform:translateX(0);}100%{transform:translateX(-50%);} }

    .glass{
      background: rgba(255,255,255,0.82);
      backdrop-filter: blur(14px);
      border:1px solid var(--glass-border);
    }
    .dark .glass{
      background: rgba(15,23,42,0.92);
      border-color: rgba(148,163,184,0.28);
    }

    .transition-smooth{ transition: all .35s cubic-bezier(.2,.9,.2,1); }

    .fade-slide-enter{ opacity:0; transform: translateY(8px) scale(.995); }
    .fade-slide-enter-active{ opacity:1; transform:none; transition: opacity .45s ease, transform .45s cubic-bezier(.2,.9,.2,1); }

    .forecast-card{ opacity:0; transform:translateY(8px); }
    .forecast-card.show{ opacity:1; transform:none; transition: opacity .45s ease, transform .45s cubic-bezier(.2,.9,.2,1); }

    .weather-anim{ position: absolute; inset:0; pointer-events:none; z-index:-1; }

    .rain-layer {
      position:absolute;
      inset:0;
      overflow:hidden;
    }
    .rain-layer i{
      position:absolute;
      bottom:110%;
      width:2px;
      background:rgba(255,255,255,0.45);
      height:18px;
      transform:rotate(-12deg);
      animation:drop 1.1s linear infinite;
    }
    @keyframes drop{
      to{
        transform: translateY(170%) rotate(-12deg);
        opacity:0;
      }
    }

    .snowflake{
      position:absolute;
      top:-12px;
      color:white;
      font-size:10px;
      opacity:0.75;
      animation:snowfall 6s linear infinite;
      text-shadow:0 0 4px rgba(255,255,255,0.6);
    }
    @keyframes snowfall{
      0%{transform:translateY(0) translateX(0);}
      100%{transform:translateY(120vh) translateX(16px); opacity:0;}
    }

   .stars{
    position:absolute;
    inset:0;
    background-image: radial-gradient(#ffffff 1px, transparent 1px);
    background-size: 120px 120px;
    opacity:0;
    animation:stars-fade 1.2s ease forwards;
  }
  @keyframes stars-fade{
    to{ opacity:.22; }
  }
   .sun-glow{
    position:absolute;
    right:6%;
    top:6%;
    width:260px;
    height:260px;
    border-radius:50%;
    filter: blur(34px);
    opacity:.22;
    box-shadow:0 0 140px 55px rgba(255,230,150,0.95);
    pointer-events:none;
  }

    @keyframes flash{
      0%{opacity:0;}
      40%{opacity:0.25;}
      100%{opacity:0;}
    }

    @media (max-width:1024px){
      #sidebar{ width:100% !important; }
    }

    .focus-ring:focus{
      outline:2px solid rgba(249,115,115,.35);
      outline-offset:2px;
    }
  </style>
</head>

<body class="font-sans text-slate-800 dark:text-slate-100 transition-smooth">

    <div class="stars"></div>
    <div class="sun-glow"></div>
    <div id="snow-container"></div>
  <div class="cloud-layer"></div>

  <div id="weather-anim" class="weather-anim"></div>

  <div id="loading-overlay" class="fixed inset-0 flex items-center justify-center bg-white/40 dark:bg-black/60 backdrop-blur-sm z-40 hidden">
    <div class="flex items-center gap-3 px-5 py-3 rounded-full glass shadow-soft">
      <div class="w-6 h-6 rounded-full border-4 border-accent border-t-transparent animate-spin"></div>
      <span class="text-sm font-medium">Fetching weather data...</span>
    </div>
  </div>

  <div class="min-h-screen flex items-center justify-center px-4 py-6">
    <div id="app-grid" class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-[280px,1fr] gap-6 lg:gap-8 transition-smooth">

      <aside id="sidebar" class="glass rounded-3xl px-5 py-6 flex flex-col justify-between shadow-soft transition-smooth" aria-label="Sidebar">
        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-semibold tracking-tight flex items-center gap-2">
                <span class="inline-flex items-center justify-center w-9 h-9 rounded-2xl bg-gradient-to-br from-blush to-lilac shadow-md">‚òÅÔ∏è</span>
                <span>Weatherzz</span>
              </h1>
              <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">How's the Weather today?</p>
              <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Let's find out!</p>
            </div>
            <div class="flex gap-2 items-center">
              <button id="locate-btn" title="Use my current location" class="p-2 rounded-xl focus-ring glass text-sm">
                üìç
              </button>
            </div>
          </div>

          <div id="sidebar-city" class="mt-4 rounded-2xl px-4 py-3 bg-skysoft/70 dark:bg-slate-900/70 border border-white/70 dark:border-slate-600 transition-smooth">
            <p class="text-xs text-slate-500 dark:text-slate-400">Active city</p>
            <p id="sidebar-city-name" class="text-lg font-semibold mt-1">Not selected</p>
            <p id="sidebar-city-time" class="text-xs text-slate-500 dark:text-slate-400 mt-1">--:--</p>
          </div>

          <div class="mt-4 relative">
            <label class="text-xs font-medium text-slate-500 dark:text-slate-400">Search city</label>
            <div class="mt-1 relative">
              <input
                id="search-input"
                placeholder="Example: Jakarta, Tokyo..."
                autocomplete="off"
                class="w-full pl-10 pr-3 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/80 text-sm outline-none focus:ring-1 focus:ring-accent focus:border-accent"
              />
              <svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 dark:text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="6" stroke-width="1.8"></circle>
                <line x1="16" y1="16" x2="20" y2="20" stroke-linecap="round" stroke-width="1.8"></line>
              </svg>
            </div>
            <div
              id="autocomplete-results"
              class="absolute left-0 right-0 mt-2 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/95 dark:bg-slate-900/95 shadow-lg max-h-56 overflow-y-auto text-sm opacity-0 pointer-events-none transition"
            ></div>
          </div>

          <div class="mt-4 space-y-3">
            <div>
              <p class="text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">Temperature unit</p>
              <div class="inline-flex rounded-full border border-slate-200 dark:border-slate-600 bg-white/70 dark:bg-slate-900/80 overflow-hidden text-xs">
                <button id="celsius-toggle" class="px-3 py-1.5 font-medium">¬∞C</button>
                <button id="fahrenheit-toggle" class="px-3 py-1.5">¬∞F</button>
              </div>
            </div>

            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs font-medium text-slate-500 dark:text-slate-400">Theme</p>
                <p class="text-[11px] text-slate-400 dark:text-slate-500">Light / Dark</p>
              </div>
              <button
                id="theme-toggle"
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full glass text-xs font-medium focus-ring"
              >
                <svg id="theme-icon" class="w-4 h-4" viewBox="0 0 24 24" fill="none"></svg>
                <span id="theme-label">Light</span>
              </button>
            </div>

            <button
              id="refresh-button"
              class="mt-2 w-full inline-flex items-center justify-center gap-2 px-3 py-2 rounded-2xl border border-slate-200 dark:border-slate-600 text-xs font-semibold hover:bg-white/80 dark:hover:bg-slate-800 transition"
            >
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path
                  d="M4 4v5h5"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M4 9a7 7 0 0 1 11-5.2L17 5"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M20 20v-5h-5"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M20 15a7 7 0 0 1-11 5.2L7 19"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Refresh Weather</span>
            </button>
          </div>

        </div>

        <div class="mt-6">
          <p class="text-xs font-medium text-slate-500 dark:text-slate-400 mb-2">Favorite cities</p>
          <div id="favorite-cities-list" class="space-y-2 text-xs max-h-40 overflow-y-auto pr-1"></div>
        </div>
      </aside>

      <main class="space-y-5 relative">
        <section class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div>
            <p class="text-xs uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400">Today‚Äôs Overview</p>
            <h2 class="text-xl font-semibold mt-1">Weather, Temperature, and Wind Conditions</h2>
          </div>
          <div id="headline-meta" class="text-xs text-slate-500 dark:text-slate-400 sm:text-right">No location selected</div>
        </section>

        <section id="current-section" class="glass rounded-3xl shadow-soft px-6 py-5 relative overflow-hidden transition-smooth">
          <div id="weather-display" class="min-h-[190px] flex items-center justify-center text-sm text-slate-500 dark:text-slate-400 transition-smooth">
            Please select a city to see the weather.
          </div>
        </section>

        <section class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="glass rounded-3xl px-4 py-4">
            <p class="text-xs text-slate-500 dark:text-slate-400">Humidity</p>
            <p id="humidity-value" class="text-3xl font-semibold mt-2">--%</p>
            <p class="text-[11px] text-slate-400 dark:text-slate-500 mt-1">Represents moisture in the air</p>
          </div>

          <div class="glass rounded-3xl px-4 py-4">
            <p class="text-xs text-slate-500 dark:text-slate-400">Wind speed</p>
            <p id="wind-value" class="text-3xl font-semibold mt-2">--</p>
            <p class="text-[11px] text-slate-400 dark:text-slate-500 mt-1">Higher values mean stronger wind</p>
          </div>

          <div class="glass rounded-3xl px-4 py-4">
            <p class="text-xs text-slate-500 dark:text-slate-400">Pressure</p>
            <p id="pressure-value" class="text-3xl font-semibold mt-2">--</p>
            <p class="text-[11px] text-slate-400 dark:text-slate-500 mt-1">Affects weather patterns</p>
          </div>
        </section>

        <section class="glass rounded-3xl px-5 py-4 shadow-soft">
          <div class="flex items-center justify-between mb-3">
            <div>
              <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-[0.18em]">Forecast</p>
              <p class="text-sm mt-0.5">Next 5 days</p>
            </div>
            <div id="forecast-label" class="text-xs text-slate-500 dark:text-slate-400">No data available.</div>
          </div>

          <div id="forecast-section" class="scrollbar flex gap-3 overflow-x-auto pb-1 transition-smooth">
            <p class="text-xs text-slate-400 dark:text-slate-500">Pick a city to view the 5-day forecast.</p>
          </div>
        </section>

      </main>
    </div>
  </div>

<script>
  const API_KEY = "e602b1df438d6c82f151deeafeb9c490";
  const BASE_URL = "https://api.openweathermap.org/data/2.5/";
  const UNITS_C = "metric";
  const UNITS_F = "imperial";

  let currentUnit = localStorage.getItem("unit-skyboard") || UNITS_C;
  let currentCity = { name: "", lat: null, lon: null, timezone: 0 };
  let themePref = localStorage.getItem("theme-skyboard") || "light"; 

  const searchInput = document.getElementById("search-input");
  const autocompleteBox = document.getElementById("autocomplete-results");
  const loadingOverlay = document.getElementById("loading-overlay");
  const weatherDisplay = document.getElementById("weather-display");
  const humidityValue = document.getElementById("humidity-value");
  const windValue = document.getElementById("wind-value");
  const pressureValue = document.getElementById("pressure-value");
  const forecastSection = document.getElementById("forecast-section");
  const forecastLabel = document.getElementById("forecast-label");
  const favoriteList = document.getElementById("favorite-cities-list");
  const sidebarCityName = document.getElementById("sidebar-city-name");
  const sidebarCityTime = document.getElementById("sidebar-city-time");
  const headlineMeta = document.getElementById("headline-meta");
  const celsiusToggle = document.getElementById("celsius-toggle");
  const fahrenheitToggle = document.getElementById("fahrenheit-toggle");
  const refreshButton = document.getElementById("refresh-button");
  const themeToggle = document.getElementById("theme-toggle");
  const themeIcon = document.getElementById("theme-icon");
  const themeLabel = document.getElementById("theme-label");
  const locateBtn = document.getElementById("locate-btn");
  const weatherAnim = document.getElementById("weather-anim");

  const showLoading = show => loadingOverlay.classList.toggle("hidden", !show);
  const unitText = () => currentUnit === UNITS_C ? "¬∞C" : "¬∞F";
  const tempFmt = v => `${Math.round(v)}${unitText()}`;
  const getIcon = (code, size = "4x") => `https://openweathermap.org/img/wn/${code}@${size}.png`;

  function applyTheme(pref){
    themePref = pref || themePref;
    localStorage.setItem('theme-skyboard', themePref);
    const isDark = themePref === 'dark';
    document.documentElement.classList.toggle('dark', isDark);
    document.querySelector('.cloud-layer').style.opacity = isDark ? '0.12' : '0.25';
    renderThemeIcon(isDark);
  }

  function renderThemeIcon(dark){
    if(dark){
      themeIcon.innerHTML = `
        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 0 0 21 12.79z"
          stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none" />
      `;
      themeLabel.textContent = 'Dark';
    } else {
      themeIcon.innerHTML = `
        <circle cx="12" cy="12" r="4.2" stroke="currentColor" stroke-width="1.6" fill="none" />
        <line x1="12" y1="3" x2="12" y2="1" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="12" y1="23" x2="12" y2="21" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="3" y1="12" x2="1" y2="12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="23" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="5" y1="5" x2="3.8" y2="3.8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="19" y1="19" x2="20.2" y2="20.2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="19" y1="5" x2="20.2" y2="3.8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
        <line x1="5" y1="19" x2="3.8" y2="20.2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
      `;
      themeLabel.textContent = 'Light';
    }
  }

  function applyUnitStyle(){
    if(currentUnit === UNITS_C){
      celsiusToggle.className = 'px-3 py-1.5 font-medium bg-accent/90 text-white';
      fahrenheitToggle.className = 'px-3 py-1.5';
    } else {
      fahrenheitToggle.className = 'px-3 py-1.5 font-medium bg-accent/90 text-white';
      celsiusToggle.className = 'px-3 py-1.5';
    }
  }

  function getFavorites(){ return JSON.parse(localStorage.getItem('skyboard-favorites')||'[]'); }
  function saveFavorites(list){ localStorage.setItem('skyboard-favorites', JSON.stringify(list)); }

  function renderFavorites(){
    const favorites = getFavorites();
    favoriteList.innerHTML='';
    if(!favorites.length){
      favoriteList.innerHTML = `<p class="text-slate-400 dark:text-slate-500">No favorite cities yet.</p>`;
      return;
    }
    favorites.forEach(city=>{
      const row=document.createElement('div');
      row.className='flex items-center justify-between px-3 py-2 rounded-2xl bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-700 cursor-pointer hover:bg-white/95 dark:hover:bg-slate-800 transition';
      row.innerHTML = `
        <div>
          <p class="font-medium text-[13px]">${city.name}</p>
          <p class="text-[11px] text-slate-400">${city.country||''}</p>
        </div>
      <button class="text-xs text-slate-400 hover:text-red-500" 
        data-lat="${city.lat}" 
        data-lon="${city.lon}" 
        title="Remove">‚úï</button>
        `;
      row.onclick = e => {
        if(e.target.tagName.toLowerCase()!=='button'){
          fetchWeather(city.lat, city.lon, city.name, city.country);
        }
      };
      row.querySelector("button").onclick = e => {
  e.stopPropagation();

  const lat = e.target.dataset.lat;
  const lon = e.target.dataset.lon;

  const updated = getFavorites().filter(f => {
    return !(String(f.lat) === String(lat) && String(f.lon) === String(lon));
  });

  saveFavorites(updated);
  renderFavorites();
};

      favoriteList.appendChild(row);
    });
  }

  let autocompleteTimer;
  searchInput.addEventListener('input', e=>{
    clearTimeout(autocompleteTimer);
    const q=e.target.value.trim();
    if(q.length<2){
      autocompleteBox.classList.add('opacity-0','pointer-events-none');
      autocompleteBox.innerHTML='';
      return;
    }
    autocompleteTimer=setTimeout(()=>fetchAutocompleteOSM(q), 300);
  });
  document.addEventListener('click', e=>{
    if(!searchInput.contains(e.target) && !autocompleteBox.contains(e.target)) {
      autocompleteBox.classList.add('opacity-0','pointer-events-none');
    }
  });

  async function fetchAutocompleteOSM(query){
    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=6`;
    try{
      const res = await fetch(url, { headers:{'User-Agent':'SkyboardApp/1.0'} });
      const data = await res.json();
      autocompleteBox.innerHTML='';
      if(!data.length){
        autocompleteBox.classList.add('opacity-0','pointer-events-none');
        return;
      }
      data.forEach(place=>{
        const option=document.createElement('div');
        option.className='px-4 py-2.5 hover:bg-skysoft/80 dark:hover:bg-slate-800 cursor-pointer text-[13px]';
        const label=place.display_name;
        option.textContent=label;
        option.onclick=()=>{
          const shortName = place.display_name.split(',')[0];
          searchInput.value = shortName;
          fetchWeather(place.lat, place.lon, shortName, place.address?.country_code?.toUpperCase()||'');
          autocompleteBox.innerHTML='';
          autocompleteBox.classList.add('opacity-0','pointer-events-none');
        };
        autocompleteBox.appendChild(option);
      });
      autocompleteBox.classList.remove('opacity-0','pointer-events-none');
    }
    catch(e){
      console.error('OSM Autocomplete Error', e);
    }
  }

  async function fetchWeather(lat, lon, cityName, countryCode){
    showLoading(true);
    try{
      const [currentRes, forecastRes] = await Promise.all([
        fetch(`${BASE_URL}weather?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${API_KEY}&lang=en`),
        fetch(`${BASE_URL}forecast?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${API_KEY}&lang=en`)
      ]);

      const currentData = await currentRes.json();
      const forecastData = await forecastRes.json();

      currentCity = {
        name: cityName,
        lat: parseFloat(lat),
        lon: parseFloat(lon),
        timezone: currentData.timezone,
        country: countryCode || currentData.sys?.country || ''
      };
      localStorage.setItem('skyboard-lastcity', JSON.stringify(currentCity));

      swapCurrentWeather(currentData);
      renderForecast(forecastData);
      renderFavorites();
      updateSidebarCity();

    } catch(e){
      console.error('Fetch error', e);
      weatherDisplay.innerHTML = `<p class="text-sm text-red-500">Failed to load weather data.</p>`;
    }
    finally{
      showLoading(false);
    }
  }

  function computeLocalTime(date, timezoneOffsetSeconds){
    const utcMs = date.getTime() + date.getTimezoneOffset()*60000;
    return new Date(utcMs + timezoneOffsetSeconds*1000);
  }

  function updateSidebarCity(){
    if(!currentCity.name){
      sidebarCityName.textContent='Not selected';
      sidebarCityTime.textContent='--:--';
      return;
    }
    const now=new Date();
    const local = computeLocalTime(now, currentCity.timezone);
    sidebarCityName.textContent = currentCity.name;
    sidebarCityTime.textContent = local.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  }

  function swapCurrentWeather(data){
    const container = weatherDisplay;
    container.classList.add('fade-slide-enter');
    container.innerHTML='';

    requestAnimationFrame(()=>{
      const temp = data.main.temp;
      const feels = data.main.feels_like;
      const desc = data.weather[0].description;
      const iconCode = data.weather[0].icon;

      humidityValue.textContent = `${data.main.humidity}%`;
      windValue.textContent = `${data.wind.speed} ${currentUnit===UNITS_C? 'm/s':'mph'}`;
      pressureValue.textContent = `${data.main.pressure} hPa`;

      const country = currentCity.country || data.sys.country || '';
      const nowLocal = computeLocalTime(new Date(), data.timezone);
      headlineMeta.textContent = `${currentCity.name}${country? ', '+country:''} ¬∑ ${nowLocal.toLocaleDateString('en-US',{weekday:'long', day:'numeric', month:'long'})}`;

      const favorites = getFavorites();
      const isFav = favorites.some(f=>f.lat === currentCity.lat);

      container.innerHTML = `
        <div class="flex flex-col items-center text-center gap-5 w-full">
          <div class="flex items-center gap-4">
            <img src="${getIcon(iconCode)}" class="w-20 h-20" alt="Weather icon" />
            <div>
              <div class="flex items-baseline gap-2">
                <p class="text-5xl font-semibold">${Math.round(temp)}</p>
                <p class="text-lg text-slate-500 dark:text-slate-400">${unitText()}</p>
              </div>
              <p class="text-sm capitalize text-slate-500 dark:text-slate-400 mt-1">${desc}</p>
              <p class="text-[11px] text-slate-400 mt-0.5">Feels like ${tempFmt(feels)}</p>
            </div>
          </div>
          <div class="flex flex-col items-center gap-2 w-full">
            <p class="text-xs text-slate-500 dark:text-slate-400">Updated: ${nowLocal.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}</p>
            <button
              id="fav-button"
              class="inline-flex items-center gap-2 px-3 py-2 rounded-2xl border text-xs font-medium ${
                isFav
                  ? 'border-accent bg-accent/10 text-accent'
                  : 'border-slate-300 dark:border-slate-600 hover:bg-white/80 dark:hover:bg-slate-800'
              }"
            >
              ${isFav ? '‚òÖ Favorite' : '‚òÜ Add to favorites'}
            </button>
          </div>
        </div>
      `;

      document.getElementById('fav-button').onclick = ()=>{
        let favs=getFavorites();
        const idx=favs.findIndex(f=>f.lat===currentCity.lat);
        if(idx>=0) favs.splice(idx,1);
        else favs.unshift(currentCity);
        saveFavorites(favs);
        renderFavorites();
        swapCurrentWeather(data);
      };

      container.classList.remove('fade-slide-enter');
      container.classList.add('fade-slide-enter-active');
      setTimeout(()=>{ container.classList.remove('fade-slide-enter-active'); }, 600);

      applyWeatherAnimation(data.weather[0].icon);
    });
  }

  function renderForecast(data){
    forecastSection.innerHTML='';
    forecastLabel.textContent='Daily around midday';

    const list=data.list || [];
    const midday=list.filter(i=>i.dt_txt && i.dt_txt.includes('12:00:00'));
    const days = (midday.length?midday:list).slice(0,5);

    if(!days.length){
      forecastSection.innerHTML='<p class="text-xs text-slate-500 dark:text-slate-400">No forecast data.</p>';
      forecastLabel.textContent='No data available';
      return;
    }

    days.forEach((item,i)=>{
      const dt = new Date(item.dt*1000);
      const label = dt.toLocaleDateString('en-US',{weekday:'short', day:'numeric', month:'short'});
      const card = document.createElement('div');
      card.className='min-w-[120px] glass rounded-2xl px-3 py-3 text-center text-xs forecast-card';
      card.innerHTML = `
        <p class="font-medium">${label}</p>
        <img src="${getIcon(item.weather[0].icon,'2x')}" class="w-12 h-12 mx-auto my-1" alt="Forecast icon" />
        <p class="capitalize text-[11px] text-slate-500 dark:text-slate-400">${item.weather[0].description}</p>
        <p class="font-semibold mt-1">${tempFmt(item.main.temp_max)}</p>
        <p class="text-[11px] text-slate-400">min ${tempFmt(item.main.temp_min)}</p>
      `;
      forecastSection.appendChild(card);
      setTimeout(()=> card.classList.add('show'), 70 * i);
    });
  }

  function applyWeatherAnimation(icon){
    weatherAnim.innerHTML='';
    const isNight = icon.endsWith('n');
    const code = icon.slice(0,2);

    if(code === '01'){ 
      const sun = document.createElement('div');
      sun.className = 'sun-glow';
      weatherAnim.appendChild(sun);
    }

    if(code === '09' || code === '10' || code === '11'){
      const rain = document.createElement('div');
      rain.className='rain-layer';
      for(let i=0;i<45;i++){
        const drop=document.createElement('i');
        drop.style.left = Math.random()*100 + '%';
        drop.style.animationDelay = (Math.random()*1).toFixed(2) + 's';
        drop.style.height = 10 + Math.random()*22 + 'px';
        drop.style.opacity = (0.15+Math.random()*0.25).toFixed(2);
        rain.appendChild(drop);
      }
      weatherAnim.appendChild(rain);

      if(code === '11'){
        const flash = document.createElement('div');
        flash.style.position='absolute';
        flash.style.inset='0';
        flash.style.background='radial-gradient(circle, rgba(255,255,255,0.18) 0%, transparent 60%)';
        flash.style.animation='flash 1.6s linear infinite';
        weatherAnim.appendChild(flash);
      }
    }

    if(code === '13'){
      for(let i=0;i<30;i++){
        const snow=document.createElement('div');
        snow.className='snowflake';
        snow.textContent='‚ú¶';
        snow.style.left = Math.random()*100 + '%';
        snow.style.fontSize = (8 + Math.random()*6) + 'px';
        snow.style.animationDelay = (Math.random()*4).toFixed(2) + 's';
        snow.style.animationDuration = (5 + Math.random()*4).toFixed(2) + 's';
        weatherAnim.appendChild(snow);
      }
    }

    if(isNight){
      const s = document.createElement('div');
      s.className='stars';
      weatherAnim.appendChild(s);
    }
  }

  let timeTicker;
  function startClock(){
    if(timeTicker) clearInterval(timeTicker);
    timeTicker = setInterval(updateSidebarCity, 1000);
  }

  function init(){
    applyTheme(themePref);
    applyUnitStyle();
    renderFavorites();
    startClock();

    const saved = localStorage.getItem('skyboard-lastcity');
    if(saved){
      try{
        const last = JSON.parse(saved);
        fetchWeather(last.lat,last.lon,last.name,last.country);
      }catch{}
    } else {
      tryAutoLocate();
    }
  }

  locateBtn.onclick = tryAutoLocate;
  async function tryAutoLocate(){
    if(!navigator.geolocation) return;
    navigator.permissions && navigator.permissions.query({name:'geolocation'}).then(p=>{
      if(p.state==='denied'){  }
    });
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude,longitude} = pos.coords;
      fetchWeather(latitude,longitude,'My Location','');
    }, err=>{
      console.warn('Geo failed', err);
    });
  }

  celsiusToggle.onclick = ()=>{
    currentUnit = UNITS_C;
    localStorage.setItem('unit-skyboard', currentUnit);
    applyUnitStyle();
    if(currentCity.lat) fetchWeather(currentCity.lat,currentCity.lon,currentCity.name,currentCity.country);
  };
  fahrenheitToggle.onclick = ()=>{
    currentUnit = UNITS_F;
    localStorage.setItem('unit-skyboard', currentUnit);
    applyUnitStyle();
    if(currentCity.lat) fetchWeather(currentCity.lat,currentCity.lon,currentCity.name,currentCity.country);
  };

  themeToggle.onclick = ()=>{
    if(themePref === 'light') applyTheme('dark');
    else applyTheme('light');
  };

  refreshButton.onclick = ()=>{
    if(currentCity.lat) fetchWeather(currentCity.lat,currentCity.lon,currentCity.name,currentCity.country);
  };

  searchInput.addEventListener('keydown', e=>{
    if(e.key==='Enter'){
      const q = searchInput.value.trim();
      if(q.length) fetchAutocompleteOSM(q);
    }
  });

  window.onload = ()=>{
    init();
    applyUnitStyle();
  };
  const snowContainer = document.getElementById("snow-container");

function createSnowflake(){
  const snow = document.createElement("div");
  snow.classList.add("snowflake");
  snow.innerHTML = "‚ùÑ";
  snow.style.left = Math.random() * window.innerWidth + "px";
  snow.style.animationDuration = (4 + Math.random() * 4) + "s";
  const size = 8 + Math.random() * 12;
  snow.style.fontSize = size + "px";

  snowContainer.appendChild(snow);
  setTimeout(() => snow.remove(), 7000);
}
setInterval(createSnowflake, 150);
</script>

</body>
</html>

